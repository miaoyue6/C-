## webserver总结篇---梳理脉络

main()开始：

（1）初始化 同步/异步日志；

（2）创建数据库连接池，因为创建数据库连接需要创建类似socket耗时，所以提前创建数据库连接池；

（3）建立连接后，需要从连接的数据库中取出表项，比如表中的passward,username等；

（4）创建监听socket-listen；

（5）创建内核事件表，用epollfd唯一标识；将listen加入epollfd，并将epollfd传入http中，方便后续注册读、写事件；

（6）创建管道，方便触发alarm信号时向主程序传递信息；

（7）设定SIGALRM信号回调处理函数，在超时发生时删除工作线程无用user；

（8)设定alarm；

（9）while()开始：

​				a.处理新到的客户连接：创建唯一标识客户端的connfd，然后再http中初始化，在http中完成epoll内核注册，在main中通过调用http中的read_once判断是否读取成功（LT/ET），成功读取后将当前用户加入工作队列；//源代码ET和read_once逻辑有点问题

​				设置用户user[connfd]的定时器，收到信号时进行处理；

​				b.收到关闭信号时，关闭连接；

​				c.处理pipe中收到的信号；

​				d.处理接收数据，如果监听到读事件，那么把该事件加入请求队列，并延迟处理器定时；

​				e.处理写事件；

## webbench

测得QPS 50000左右，客户端10000，运行时间5s；



